import{_ as r,c as m,a as p,b as t,e as s,f as n,d as i,r as l,o as f}from"./app-DeWhPSCw.js";const c={},u={class:"vp-file-tree"},v={class:"tree-node folder"},g={class:"tree-node file"},h={class:"tree-node file"},x={class:"tree-node file"},_={class:"tree-node file"},y={class:"tree-node folder"},D={class:"tree-node file"},j={class:"tree-node file"},b={class:"tree-node file"},k={class:"tree-node file"};function q(L,e){const a=l("VPIcon"),o=l("FileTreeItem"),d=l("RouteLink");return f(),m("div",null,[e[14]||(e[14]=p('<div class="hint-container warning"><p class="hint-container-title">版权声明</p><p>本节所使用的模型来自手游《碧蓝航线》，其中：<br> “<strong>安克雷奇的换装‘海豚、海洋、游泳课’</strong>”模型仅作为修复示例，不会预置在App中，<br> 版权归原作者所有，若认为侵权请通过官网的【更多】-&gt;【社交媒体】或App中的【关于】-&gt;【意见反馈】中联系开发者。</p></div><h2 id="q-点击动作列表中的动作发生闪退-如何解决" tabindex="-1"><a class="header-anchor" href="#q-点击动作列表中的动作发生闪退-如何解决"><span>Q：点击动作列表中的动作发生闪退，如何解决？</span></a></h2><div class="hint-container note"><p class="hint-container-title">注</p><p>接下来的问题复现以及修复过程均以手游《碧蓝航线》中安克雷奇的换装“海豚、海洋、游泳课”为例。</p></div><p>示例用到的模型文件结构如下：</p>',4)),t("div",u,[t("ul",null,[s(o,{type:"folder",expanded:!0,empty:!1},{default:n(()=>[t("span",v,[s(a,{name:"vscode-icons:default-folder"}),e[0]||(e[0]=t("span",{class:"name"},"motions",-1))]),t("ul",null,[s(o,{type:"file",expanded:!1,empty:!0},{default:n(()=>[t("span",g,[s(a,{name:"vscode-icons:file-type-json"}),e[1]||(e[1]=t("span",{class:"name"},"complete.motion3.json",-1))])]),_:1}),s(o,{type:"file",expanded:!1,empty:!0},{default:n(()=>[t("span",h,[s(a,{name:"vscode-icons:file-type-json"}),e[2]||(e[2]=t("span",{class:"name"},"effect.motion3.json",-1))])]),_:1}),s(o,{type:"file",expanded:!1,empty:!0},{default:n(()=>[t("span",x,[s(a,{name:"vscode-icons:file-type-json"}),e[3]||(e[3]=t("span",{class:"name"},"home.motion3.json",-1))])]),_:1}),s(o,{type:"file",expanded:!1,empty:!0},{default:n(()=>[t("span",_,[s(a,{name:"vscode-icons:default-file"}),e[4]||(e[4]=t("span",{class:"name"},"（共16个动作json文件）...",-1))])]),_:1})])]),_:1}),s(o,{type:"folder",expanded:!0,empty:!1},{default:n(()=>[t("span",y,[s(a,{name:"vscode-icons:default-folder"}),e[5]||(e[5]=t("span",{class:"name"},"textures",-1))]),t("ul",null,[s(o,{type:"file",expanded:!1,empty:!0},{default:n(()=>[t("span",D,[s(a,{name:"vscode-icons:file-type-image"}),e[6]||(e[6]=t("span",{class:"name"},"texture_00.png",-1))])]),_:1})])]),_:1}),s(o,{type:"file",expanded:!1,empty:!0},{default:n(()=>[t("span",j,[s(a,{name:"vscode-icons:default-file"}),e[7]||(e[7]=t("span",{class:"name"},"ankeleiqi_2.moc3",-1))])]),_:1}),s(o,{type:"file",expanded:!1,empty:!0},{default:n(()=>[t("span",b,[s(a,{name:"vscode-icons:file-type-json"}),e[8]||(e[8]=t("span",{class:"name"},"ankeleiqi_2.model3.json",-1))])]),_:1}),s(o,{type:"file",expanded:!1,empty:!0},{default:n(()=>[t("span",k,[s(a,{name:"vscode-icons:file-type-json"}),e[9]||(e[9]=t("span",{class:"name"},"ankeleiqi_2.physics3.json",-1))])]),_:1})])]),e[15]||(e[15]=p('<h3 id="模型正确性验证" tabindex="-1"><a class="header-anchor" href="#模型正确性验证"><span>模型正确性验证</span></a></h3><p>在电脑端使用Live2D Cubism Viewer 4.2，双击<code>ankeleiqi_2.moc3</code>查看模型，发现能够正常打开；播放<code>motions</code>文件夹下的动作<code>complete.motion3.json</code>，发现可以正常播放动作，说明模型本身应该是没有问题的。</p><img src="https://img.moetranslate.top/faq_pc.png"><h3 id="问题复现" tabindex="-1"><a class="header-anchor" href="#问题复现"><span>问题复现</span></a></h3><p>将模型导入到萌译，点击动作列表中相同的动作<code>complete.motion3.json</code>，萌译发生闪退。</p><div class="hint-container tip"><p class="hint-container-title">是不是萌译的Live 2D代码出现了问题？</p><p>是这样也不是这样。萌译的Live 2D功能使用了Live 2D SDK，这一部分的代码并不是萌译的开发者写的；在发现该问题并进行排查时，开发者也将安克雷奇的皮肤移植到了官方的安卓Sample中进行测试，同样出现了闪退的问题。</p></div><img src="https://img.moetranslate.top/faq_exit.jpg"><h3 id="问题排查" tabindex="-1"><a class="header-anchor" href="#问题排查"><span>问题排查</span></a></h3>',8)),t("p",null,[e[12]||(e[12]=i("下面是对问题进行排查的过程，有一定的编程能力要求，读者感兴趣的话可以继续阅读，也可")),t("strong",null,[e[11]||(e[11]=i("直接跳转到")),s(d,{to:"/docs/live2d/faq/#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"},{default:n(()=>e[10]||(e[10]=[i("解决方案")])),_:1})]),e[13]||(e[13]=i("。"))]),e[16]||(e[16]=p('<p>将手机连接Android Studio，打开Logcat，在切换到安克雷奇的换装时，注意到SDK的报错如下所示。</p><img src="https://img.moetranslate.top/faq_logcat.png"><p>对报错信息和函数调用进行追踪，发现错误出现在Live 2D SDK的Framework中。</p><img src="https://img.moetranslate.top/faq_call_stack.png"><p>结合该函数以及报错信息<code>Index xxxx out of bounds for length xxxx</code>，不难发现是在加载动作时出现了长度越界问题。</p><p>由于开发者并不是Live 2D的从业人员，Live 2D的SDK也并非完全开源，因此并不清楚Live 2D SDK内部是如何处理动作的json文件的。目前只能推测可能是版本兼容性问题，细心的读者可能注意到，之前在PC端使用Live2D Cubism Viewer 4.2查看模型时，显示模型遵循的Live 2D SDK版本是3.3，如下图所示；而萌译使用的Live 2D SDK是最新的Cubism 5 SDK for Java R2。</p><img src="https://img.moetranslate.top/faq_version.png"><p>因此推测闪退的原因是萌译使用的Live 2D SDK（Java）版本对旧版的SDK规范兼容性较差，导致播放旧版本的Live 2D动作时会出现越界问题，进而发生闪退；而PC端的Live2D Cubism Viewer能够兼容旧版的SDK规范，因此可以正常播放；也进一步推测《碧蓝航线》手游使用的Live 2D SDK（Java）版本应该较旧，以正常播放Live 2D模型的动作。</p><h3 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案"><span>解决方案</span></a></h3><p>虽然对于闪退的内部机理仍不清楚，但这并不妨碍我们解决这个问题，解决步骤如下：</p><div class="vp-steps"><ol><li><p>在萌译中删除闪退的模型</p><p>打开模型列表，长按播放动作会闪退的模型，点击【删除模型】。</p><img src="https://img.moetranslate.top/faq_delete.jpg"></li><li><p>找到动作json文件</p><p>使用文件管理器（这里开发者使用的是<a href="https://mt2.cn/" target="_blank" rel="noopener noreferrer">MT管理器</a>），找到您导入模型时选择的文件夹，并打开该模型的动作文件夹，以安克雷奇的换装为例，就是打开文件树中的motions文件夹。</p><img src="https://img.moetranslate.top/faq_find.jpg"></li><li><p>修改所有的动作json文件</p><p>逐个打开文件夹中的动作json文件（其实就是文本文件），因为报错提示的是越界，因此我们可以粗暴地将<code>TotalPointCount</code>对应的数据改为<code>999999</code>（“9”不要太多，防止数据溢出），修改完<strong>不要忘了保存</strong>。注意要<strong>修改所有</strong>点击后会发生闪退的动作json文件（基本上就是所有的动作json文件了）。</p><img src="https://img.moetranslate.top/faq_json.jpg"></li><li><p>重新导入模型</p><p>修改完成后，打开萌译，重新导入模型，应该发现可以正常播放动作了。</p><img src="https://img.moetranslate.top/faq_fix.jpg"></li></ol></div>',11))])}const K=r(c,[["render",q],["__file","index.html.vue"]]),C=JSON.parse('{"path":"/docs/live2d/faq/","title":"常见问题","lang":"zh-CN","frontmatter":{"title":"常见问题","author":"azuki","createTime":"2024/03/02 10:48:14","permalink":"/docs/live2d/faq/"},"headers":[],"readingTime":{"minutes":3.87,"words":1160},"git":{"updatedTime":1739603047000,"contributors":[{"name":"azuki","email":"azuki.yang@foxmail.com","commits":8,"avatar":"https://avatars.githubusercontent.com/azuki?v=4","url":"https://github.com/azuki"},{"name":"azuki","email":"448117151@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/azuki?v=4","url":"https://github.com/azuki"}]},"filePathRelative":"notes/docs/live2d/常见问题.md","bulletin":false}');export{K as comp,C as data};
